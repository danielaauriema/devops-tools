---
- name: Create ghcr.io/ldapaccountmanager container
  docker_container:
    name: "lam"
    image: "ghcr.io/ldapaccountmanager/lam:stable"
    state: started
    restart: no
    restart_policy: always
    comparisons:
      published_ports: strict
    ports: "{{ lam_port_bind }}"
    volumes:
      - "{{ lam_data_path }}/etc:/etc/ldap-account-manager"
    env:
      LAM_SKIP_PRECONFIGURE: "false"
      LDAP_DOMAIN: "{{ ldap_base_dn }}"
      LDAP_BASE_DN: "{{ ldap_base_dn }}"
      LDAP_USERS_DN: "ou=people,{{ ldap_base_dn }}"
      LDAP_GROUPS_DN: "ou=groups,{{ ldap_base_dn }}"
      LDAP_SERVER: "ldap://ldap:1389"
      LDAP_USER: "cn={{ ldap_admin_username }},{{ ldap_base_dn }}"
      LAM_LANG: "en_US"
      LAM_PASSWORD: "{{ lam_password }}"
      
      LDAP_ORGANISATION: "{{ lam_organization_name }}"
      LDAP_ADMIN_PASSWORD: "{{ ldap_bind_password }}"
      LDAP_READONLY_USER_PASSWORD: "{{ ldap_bind_password }}"
    network_mode: bridge
    networks:
      - name: "{{ lam_network }}"
